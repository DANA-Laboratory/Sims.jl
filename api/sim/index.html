<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Simulations - Sims.jl</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/github.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Sims.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../basics">Basics</a>
                            </li>
                        
                            <li >
                                <a href="../../plotting">Plotting results</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../main">Modeling</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">Simulations</a>
                            </li>
                        
                            <li >
                                <a href="../utils">Utilities</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Standard library <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../lib/types">Types</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/blocks">Continuous blocks</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/electrical">Electrical</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/heat_transfer">Heat transfer</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/powersystems">Power systems</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/rotational">Rotational mechanics</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../examples/basics">Basics</a>
                            </li>
                        
                            <li >
                                <a href="../../examples/lib">Standard library</a>
                            </li>
                        
                            <li >
                                <a href="../../examples/neural">Neural</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Design <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../design">Considerations</a>
                            </li>
                        
                            <li >
                                <a href="../../future">Development options</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../license">License</a>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../main">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../utils">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/tshort/Sims.jl/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#simulations">Simulations</a></li>
        
            <li><a href="#create_sim">create_sim</a></li>
        
            <li><a href="#create_simstate">create_simstate</a></li>
        
            <li><a href="#dasslsim">dasslsim</a></li>
        
            <li><a href="#elaborate">elaborate</a></li>
        
            <li><a href="#sunsim">sunsim</a></li>
        
            <li><a href="#sim">sim</a></li>
        
            <li><a href="#equationset">EquationSet</a></li>
        
            <li><a href="#sim_1">Sim</a></li>
        
            <li><a href="#simfunctions">SimFunctions</a></li>
        
            <li><a href="#simresult">SimResult</a></li>
        
            <li><a href="#simstate">SimState</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="simulations">Simulations</h1>
<p>Various functions for simulations and building simulation objects from models.</p>
<h2 id="create_sim">create_sim</h2>
<p><code>create_sim</code> converts a model to a Sim.</p>
<div class="codehilite"><pre><span class="n">create_sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Model</span><span class="p">)</span>
<span class="n">create_sim</span><span class="p">(</span><span class="n">eq</span><span class="p">::</span><span class="n">EquationSet</span><span class="p">)</span>
</pre></div>


<h3 id="arguments">Arguments</h3>
<ul>
<li><code>m::Model</code> : a Model</li>
<li><code>eq::EquationSet</code> : a flattened model</li>
</ul>
<h3 id="returns">Returns</h3>
<ul>
<li><code>::Sim</code> : a simulation object</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/simcreation.jl#L97">Sims/src/simcreation.jl:97</a></p>
<h2 id="create_simstate">create_simstate</h2>
<p><code>create_simstate</code> converts a Sim is the main conversion function that
returns a SimState, a simulation object with state history.</p>
<div class="codehilite"><pre><span class="n">create_simstate</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Model</span><span class="p">)</span>
<span class="n">create_simstate</span><span class="p">(</span><span class="n">eq</span><span class="p">::</span><span class="n">EquationSet</span><span class="p">)</span>
<span class="n">create_simstate</span><span class="p">(</span><span class="n">sm</span><span class="p">::</span><span class="n">Sim</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_1">Arguments</h3>
<ul>
<li><code>m::Model</code> : a Model</li>
<li><code>eq::EquationSet</code> : a flattened model</li>
<li><code>sm::Sim</code> : a simulation object</li>
</ul>
<h3 id="returns_1">Returns</h3>
<ul>
<li><code>::Sim</code> : a simulation object</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/simcreation.jl#L141">Sims/src/simcreation.jl:141</a></p>
<h2 id="dasslsim">dasslsim</h2>
<p>The solver that uses DASKR, a variant of DASSL.</p>
<p>See <a href="#sim">sim</a> for the interface.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/dassl.jl#L56">Sims/src/dassl.jl:56</a></p>
<h2 id="elaborate">elaborate</h2>
<p><code>elaborate</code> is the main elaboration function that returns
a flattened model representation that can be used by <code>sim</code>.</p>
<div class="codehilite"><pre><span class="n">elaborate</span><span class="p">(</span><span class="n">a</span><span class="p">::</span><span class="n">Model</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_2">Arguments</h3>
<ul>
<li><code>a::Model</code> : the input model</li>
</ul>
<h3 id="returns_2">Returns</h3>
<ul>
<li><code>::EquationSet</code> : the flattened model</li>
</ul>
<h3 id="details">Details</h3>
<p>The main steps in flattening are:</p>
<ul>
<li>Replace fixed initial values.</li>
<li>Flatten models and populate <code>eq.equations</code>.</li>
<li>Pull out InitialEquations and populate <code>eq.initialequations</code>.</li>
<li>Pull out Events and populate <code>eq.events</code>.</li>
<li>Handle StructuralEvents.</li>
<li>Collect nodes and populate <code>eq.nodeMap</code>.</li>
<li>Strip out MExpr's from expressions.</li>
<li>Remove empty equations.</li>
</ul>
<p>There is currently no real symbolic processing (sorting, index
reduction, or any of the other stuff a fancy modeling tool would do).</p>
<p>In EquationSet, <code>model</code> contains equations and StructuralEvents. When
a StructuralEvent triggers, the entire model is elaborated again.
The first step is to replace StructuralEvents that have activated
with their new_relation in model. Then, the rest of the EquationSet
is reflattened using <code>model</code> as the starting point.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/elaboration.jl#L69">Sims/src/elaboration.jl:69</a></p>
<h2 id="sunsim">sunsim</h2>
<p>The solver that uses Sundials.</p>
<p>See <a href="#sim">sim</a> for the interface.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/sundials.jl#L109">Sims/src/sundials.jl:109</a></p>
<h2 id="sim">sim</h2>
<p><code>sim</code> is the name of the default solver used to simulate Sims models
and also shows the generic simulation API for available solvers
(currently <code>dasslsim</code> and <code>sunsim</code>). The default solver is currently
<code>dasslsim</code>.</p>
<p><code>sim</code> has many method definitions to accomodate solutions based on
intermediate model representations. Also, both positional and keyword
arguments are supported (use one or the other after the first
argument).</p>
<div class="codehilite"><pre><span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Model</span><span class="p">,</span> <span class="n">tstop</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">reltol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">abstol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Model</span><span class="p">;</span> <span class="n">tstop</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">reltol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">abstol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Sim</span><span class="p">,</span> <span class="n">tstop</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">reltol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">abstol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Sim</span><span class="p">;</span> <span class="n">tstop</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">reltol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">abstol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">SimState</span><span class="p">,</span> <span class="n">tstop</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">reltol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">abstol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">SimState</span><span class="p">;</span> <span class="n">tstop</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Nsteps</span><span class="p">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">reltol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">abstol</span><span class="p">::</span><span class="kt">Float64</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_3">Arguments</h3>
<ul>
<li><code>m::Model</code> : a Model</li>
<li><code>sm::Sim</code> : a simulation object</li>
<li><code>ss::SimState</code> : a simulation object</li>
<li><code>tstop::Float64</code> : the simulation stopping time [secs], default = 1.0</li>
<li><code>Nsteps::Int</code> : the number of simulation steps, default = 500</li>
<li><code>reltol::Float64</code> : the relative tolerance, default = 1e-4</li>
<li><code>abstol::Float64</code> : the absolute tolerance, default = 1e-4</li>
</ul>
<h3 id="returns_3">Returns</h3>
<ul>
<li><code>::SimResult</code> : the simulation result</li>
</ul>
<p>A number of optional packages can be used with results, including:</p>
<ul>
<li>Winston - plotting: <code>wplot(y::SimResult)</code></li>
<li>Gaston - plotting: <code>gplot(y::SimResult)</code> </li>
<li>DataFrames - conversion to a DataFrame: <code>convert(DataFrame, y::SimResult)</code> </li>
<li>Gadfly - plotting: <code>plot(y::SimResult, ...)</code> </li>
</ul>
<p>For each of these, the package must be installed, and the package
pulled in with <code>require</code> or <code>using</code>.</p>
<h3 id="details_1">Details</h3>
<p>The main steps in converting to a model and doing a simulation are:</p>
<div class="codehilite"><pre><span class="n">eqs</span><span class="p">::</span><span class="n">EquationSet</span> <span class="o">=</span> <span class="n">elaborate</span><span class="p">(</span><span class="n">m</span><span class="p">::</span><span class="n">Model</span><span class="p">)</span>   <span class="c"># flatten the model</span>
<span class="n">sm</span><span class="p">::</span><span class="n">Sim</span> <span class="o">=</span> <span class="n">create_sim</span><span class="p">(</span><span class="n">eqs</span><span class="p">::</span><span class="n">EquationSet</span><span class="p">)</span>   <span class="c"># prepare for simulation</span>
<span class="n">sm</span><span class="p">::</span><span class="n">SimState</span> <span class="o">=</span> <span class="n">create_simstate</span><span class="p">(</span><span class="n">sm</span><span class="p">::</span><span class="n">Sim</span><span class="p">)</span>  <span class="c"># prepare for simulation II</span>
<span class="n">y</span><span class="p">::</span><span class="n">SimResult</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">ss</span><span class="p">::</span><span class="n">SimState</span><span class="p">)</span>         <span class="c"># simulate</span>
</pre></div>


<p>The following are equivalent:</p>
<div class="codehilite"><pre><span class="n">y</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">create_simstate</span><span class="p">(</span><span class="n">create_sim</span><span class="p">(</span><span class="n">elaborate</span><span class="p">(</span><span class="n">m</span><span class="p">))))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>


<h3 id="example">Example</h3>
<div class="codehilite"><pre><span class="k">using</span> <span class="n">Sims</span>
<span class="k">function</span><span class="nf"> Vanderpol</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)</span>   <span class="c"># The 1.0 is the initial value. &quot;y&quot; is for plotting.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>        <span class="c"># The initial value is zero if not given.</span>
    <span class="c"># The following gives the return value which is a list of equations.</span>
    <span class="c"># Expressions with Unknowns are kept as expressions. Expressions of</span>
    <span class="c"># regular variables are evaluated immediately (like normal).</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="c"># The -1.0 in der(x, -1.0) is the initial value for the derivative </span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> 
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">Vanderpol</span><span class="p">()</span>       <span class="c"># returns the hierarchical model</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sunsim</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="k">using</span> <span class="n">Winston</span>
<span class="n">wplot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/sim.jl#L92">Sims/src/sim.jl:92</a></p>
<h2 id="equationset">EquationSet</h2>
<p>A representation of a flattened model, normally created with
<code>elaborate(model)</code>. <code>sim</code> uses an elaborated model for simulations.</p>
<p>Contains the hierarchical equations, flattened equations, flattened
initial equations, events, event response functions, and a map of
Unknown nodes.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/elaboration.jl#L20">Sims/src/elaboration.jl:20</a></p>
<h2 id="sim_1">Sim</h2>
<p>A type for holding several simulation objects needed for simulation,
normally created with <code>create_sim(eqs)</code>. </p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/simcreation.jl#L42">Sims/src/simcreation.jl:42</a></p>
<h2 id="simfunctions">SimFunctions</h2>
<p>The set of functions used in the DAE solution. Includes an initial set
of equations, a residual function, and several functions for detecting
and responding to events.</p>
<p>All functions take (t,y,yp) as arguments. {TODO: is this still right?}</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/simcreation.jl#L24">Sims/src/simcreation.jl:24</a></p>
<h2 id="simresult">SimResult</h2>
<p>A type holding simulation results from <code>sim</code>, <code>dasslsim</code>, or
<code>sunsim</code>. Includes a matrix of results and a vector of column names.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/simcreation.jl#L427">Sims/src/simcreation.jl:427</a></p>
<h2 id="simstate">SimState</h2>
<p>The top level type for holding all simulation objects needed for
simulation, including a Sim. Normally created with
<code>create_simstate(sim)</code>.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/a04671cab72f6bbaee67551195668c1edb7b0dd7/src/simcreation.jl#L70">Sims/src/simcreation.jl:70</a></p>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>