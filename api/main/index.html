<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Modeling - Sims.jl</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/github.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Sims.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../basics">Basics</a>
                            </li>
                        
                            <li >
                                <a href="../../plotting">Plotting results</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li class="active">
                                <a href=".">Modeling</a>
                            </li>
                        
                            <li >
                                <a href="../sim">Simulations</a>
                            </li>
                        
                            <li >
                                <a href="../utils">Utilities</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Standard library <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../lib/types">Types</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/blocks">Continuous blocks</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/electrical">Electrical</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/heat_transfer">Heat transfer</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/powersystems">Power systems</a>
                            </li>
                        
                            <li >
                                <a href="../../lib/rotational">Rotational mechanics</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../examples/basics">Basics</a>
                            </li>
                        
                            <li >
                                <a href="../../examples/lib">Standard library</a>
                            </li>
                        
                            <li >
                                <a href="../../examples/neural">Neural</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Design <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../design">Considerations</a>
                            </li>
                        
                            <li >
                                <a href="../../future">Development options</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../license">License</a>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../../plotting">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../sim">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/tshort/Sims.jl/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#building-models">Building models</a></li>
        
            <li><a href="#boolevent">BoolEvent</a></li>
        
            <li><a href="#branch">Branch</a></li>
        
            <li><a href="#addhook">addhook!</a></li>
        
            <li><a href="#compatible_values">compatible_values</a></li>
        
            <li><a href="#delay">delay</a></li>
        
            <li><a href="#der">der</a></li>
        
            <li><a href="#ifelse">ifelse</a></li>
        
            <li><a href="#is_unknown">is_unknown</a></li>
        
            <li><a href="#mexpr">mexpr</a></li>
        
            <li><a href="#name">name</a></li>
        
            <li><a href="#pre">pre</a></li>
        
            <li><a href="#reinit">reinit</a></li>
        
            <li><a href="#value">value</a></li>
        
            <li><a href="#equation">Equation</a></li>
        
            <li><a href="#mtime">MTime</a></li>
        
            <li><a href="#model">Model</a></li>
        
            <li><a href="#equations">@equations</a></li>
        
            <li><a href="#defaultunknown">DefaultUnknown</a></li>
        
            <li><a href="#derunknown">DerUnknown</a></li>
        
            <li><a href="#discrete">Discrete</a></li>
        
            <li><a href="#discretevar">DiscreteVar</a></li>
        
            <li><a href="#event">Event</a></li>
        
            <li><a href="#initialequation">InitialEquation</a></li>
        
            <li><a href="#leftvar">LeftVar</a></li>
        
            <li><a href="#mexpr_1">MExpr</a></li>
        
            <li><a href="#modeltype">ModelType</a></li>
        
            <li><a href="#parametertunknowncategory">Parameter{T&lt;:UnknownCategory}</a></li>
        
            <li><a href="#passedunknown">PassedUnknown</a></li>
        
            <li><a href="#refbranch">RefBranch</a></li>
        
            <li><a href="#refdiscrete">RefDiscrete</a></li>
        
            <li><a href="#refunknowntunknowncategory">RefUnknown{T&lt;:UnknownCategory}</a></li>
        
            <li><a href="#structuralevent">StructuralEvent</a></li>
        
            <li><a href="#unknowncategory">UnknownCategory</a></li>
        
            <li><a href="#unknownvariable">UnknownVariable</a></li>
        
            <li><a href="#unknowntunknowncategory">Unknown{T&lt;:UnknownCategory}</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="building-models">Building models</h1>
<p>The API for building models with Sims. Includes basic types, models,
and functions.</p>
<h2 id="boolevent">BoolEvent</h2>
<p>BoolEvent is a helper for attaching an event to a boolean variable.
In conjunction with <code>ifelse</code>, this allows constructs like Modelica's
if blocks.</p>
<p>Note that the lengths of <code>d</code> and <code>condition</code> must match for arrays.</p>
<div class="codehilite"><pre><span class="n">BoolEvent</span><span class="p">(</span><span class="n">d</span><span class="p">::</span><span class="n">Discrete</span><span class="p">,</span> <span class="n">condition</span><span class="p">::</span><span class="n">ModelType</span><span class="p">)</span>
</pre></div>


<h3 id="arguments">Arguments</h3>
<ul>
<li><code>d::Discrete</code> : the discrete variable.</li>
<li><code>condition::ModelType</code> : the model expression(s) </li>
</ul>
<h3 id="returns">Returns</h3>
<ul>
<li><code>::Event</code> : a model Event</li>
</ul>
<h3 id="examples">Examples</h3>
<p>See <a href="../../../lib/index.html#IdealDiode">IdealDiode</a> and
<a href="../../../lib/index.html#Limiter">Limiter</a> in the standard library.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1167">Sims/src/main.jl:1167</a></p>
<h2 id="branch">Branch</h2>
<p>A helper Model to connect a branch between two different nodes and
specify potential between nodes and the flow between nodes.</p>
<p>See also <a href="#RefBranch">RefBranch</a>.</p>
<div class="codehilite"><pre><span class="n">Branch</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_1">Arguments</h3>
<ul>
<li><code>n1</code> : the positive reference node.</li>
<li><code>n2</code> : the negative reference node.</li>
<li><code>v</code> : the potential variable between nodes.</li>
<li><code>i</code> : the flow variable between nodes.</li>
</ul>
<h3 id="returns_1">Returns</h3>
<ul>
<li><code>::Array{Equation}</code> : the model, consisting of a RefBranch entry for
  each node and an equation assigning <code>v</code> to <code>n1 - n2</code>.</li>
</ul>
<h3 id="references">References</h3>
<p>This nodal description is based on work by <a href="http://web.ict.kth.se/~dbro/">David
Broman</a>. See the following:</p>
<ul>
<li>http://www.eecs.berkeley.edu/Pubs/TechRpts/2012/EECS-2012-173.pdf</li>
<li>http://www.bromans.com/software/mkl/mkl-source-1.0.0.zip</li>
<li>https://github.com/david-broman/modelyze</li>
</ul>
<h3 id="examples_1">Examples</h3>
<p>Here is the definition of an electrical resistor in the standard
library:</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> Resistor</span><span class="p">(</span><span class="n">n1</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">n2</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">R</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">Current</span><span class="p">(</span><span class="n">compatible_values</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">Voltage</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">-</span> <span class="n">value</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">Branch</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">R</span> <span class="o">.*</span> <span class="n">i</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L766">Sims/src/main.jl:766</a></p>
<h2 id="addhook">addhook!</h2>
<p>Add hooks to a Discrete variable.</p>
<p>The propagation and handling of Discrete variables is currently rather
simple. It would be nice for Discrete variables to handle data flows
like a reactive programming system. This allows for a simple way to
add some value propagation.</p>
<h3 id="arguments_2">Arguments</h3>
<ul>
<li><code>d::Discrete</code> : the discrete variable.</li>
<li><code>ex::ModelType</code> : the value of the delay; may be an object or Unknown.</li>
</ul>
<h3 id="returns_2">Returns</h3>
<ul>
<li><code>Void</code></li>
</ul>
<h3 id="examples_2">Examples</h3>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> test_BoolEventHook</span><span class="p">()</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">Voltage</span><span class="p">(</span><span class="s">&quot;n1&quot;</span><span class="p">)</span>
    <span class="n">sig2</span> <span class="o">=</span> <span class="n">Discrete</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">Discrete</span><span class="p">(</span><span class="n">false</span><span class="p">)</span>
    <span class="n">Sims</span><span class="o">.</span><span class="n">addhook</span><span class="o">!</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> 
             <span class="n">reinit</span><span class="p">(</span><span class="n">sig2</span><span class="p">,</span> <span class="n">false</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Equation</span><span class="p">[</span>
        <span class="n">SineVoltage</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">sig2</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span> 
        <span class="n">BoolEvent</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">MTime</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">)</span>  
        <span class="n">Resistor</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
    <span class="p">]</span>
<span class="k">end</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">test_BoolEventHook</span><span class="p">())</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L998">Sims/src/main.jl:998</a></p>
<h2 id="compatible_values">compatible_values</h2>
<p>A helper functions to return the base value from an Unknown to use
when creating other Unknowns. It is especially useful for taking two
model arguments and creating a new Unknown compatible with both
arguments.</p>
<div class="codehilite"><pre><span class="n">compatible_values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">compatible_values</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>


<p>It's still somewhat broken but works for basic cases. No type
promotion is currently done.</p>
<h3 id="arguments_3">Arguments</h3>
<ul>
<li><code>x</code>, <code>y</code> : objects or Unknowns</li>
</ul>
<h3 id="returns_3">Returns</h3>
<p>The returned object has zeros of type and length common to both <code>x</code>
and <code>y</code>.</p>
<h3 id="examples_3">Examples</h3>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">45.0</span> <span class="o">+</span> <span class="mi">10</span><span class="nb">im</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="n">compatible_values</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>   <span class="c"># Initialized to 0.0 + 0.0im.</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="n">compatible_values</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> <span class="c"># Initialized to [0.0, 0.0].</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L639">Sims/src/main.jl:639</a></p>
<h2 id="delay">delay</h2>
<p>A Model specifying a delay to an Unknown.</p>
<p>Internally, Unknowns that are delayed store past history. This is
interpolated as needed to find the delayed quantity.</p>
<div class="codehilite"><pre><span class="n">delay</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">Unknown</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_4">Arguments</h3>
<ul>
<li><code>x::Unknown</code> : the quantity to be delayed.</li>
<li><code>val</code> : the value of the delay; may be an object or Unknown.</li>
</ul>
<h3 id="returns_4">Returns</h3>
<ul>
<li><code>::MExpr</code> : a delayed Unknown</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L877">Sims/src/main.jl:877</a></p>
<h2 id="der">der</h2>
<p>Represents the derivative of an Unknown.</p>
<div class="codehilite"><pre><span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">Unknown</span><span class="p">)</span>
<span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">Unknown</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_5">Arguments</h3>
<ul>
<li><code>x::Unknown</code> : the Unknown variable</li>
<li><code>val</code> : initial value, defaults to 0.0</li>
</ul>
<h3 id="examples_4">Examples</h3>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">der</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L294">Sims/src/main.jl:294</a></p>
<h2 id="ifelse">ifelse</h2>
<p>A function allowing if-then-else action for objections and expressions.</p>
<p>Note that when this is used in a model, it does not trigger an
event. You need to use <code>Event</code> or <code>BoolEvent</code> for that. It is used
often in conjunction with <code>Event</code>.</p>
<div class="codehilite"><pre><span class="n">ifelse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">ifelse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_6">Arguments</h3>
<ul>
<li><code>x</code> : the condition, a Bool or ModelType</li>
<li><code>y</code> : the value to return when true</li>
<li><code>z</code> : the value to return when false, defaults to <code>nothing</code></li>
</ul>
<h3 id="returns_5">Returns</h3>
<ul>
<li>Either <code>y</code> or <code>z</code></li>
</ul>
<h3 id="examples_5">Examples</h3>
<p>See <a href="../../../lib/index.html#DeadZone">DeadZone</a> and
<a href="../../../lib/index.html#Limiter">Limiter</a> in the standard library.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1210">Sims/src/main.jl:1210</a></p>
<h2 id="is_unknown">is_unknown</h2>
<p>Is the object an UnknownVariable?</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L245">Sims/src/main.jl:245</a></p>
<h2 id="mexpr">mexpr</h2>
<p>Create MExpr's (model expressions). Analogous to <code>expr</code> in Base.</p>
<p>This is also useful for wrapping user-defined functions where
the built-in mechanisms don't work.</p>
<div class="codehilite"><pre><span class="n">mexpr</span><span class="p">(</span><span class="n">head</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">args</span><span class="p">::</span><span class="n">ANY</span><span class="o">...</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_7">Arguments</h3>
<ul>
<li><code>head::Symbol</code> : the expression head</li>
<li><code>args...</code> : values and expressions passed to expression
  arguments</li>
</ul>
<h3 id="returns_6">Returns</h3>
<ul>
<li><code>ex::MExpr</code> : a model expression</li>
</ul>
<h3 id="examples_6">Examples</h3>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="nb">typeof</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">myfun</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">mexpr</span><span class="p">(:</span><span class="n">call</span><span class="p">,</span> <span class="p">:</span><span class="n">myfun</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L354">Sims/src/main.jl:354</a></p>
<h2 id="name">name</h2>
<p>The name of an UnknownVariable.</p>
<div class="codehilite"><pre><span class="n">name</span><span class="p">(</span><span class="n">a</span><span class="p">::</span><span class="n">UnknownVariable</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_8">Arguments</h3>
<ul>
<li><code>x::UnknownVariable</code></li>
</ul>
<h3 id="returns_7">Returns</h3>
<ul>
<li><code>s::String</code> : either the label of the Unknown or if that's blank,
  the symbol name of the Unknown.</li>
</ul>
<h3 id="examples_7">Examples</h3>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="s">&quot;var1&quot;</span><span class="p">)</span>
<span class="n">name</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L599">Sims/src/main.jl:599</a></p>
<h2 id="pre">pre</h2>
<p>The value of a Discrete variable <code>x</code> prior to an event.</p>
<p>See also <a href="#Event">Event</a>.</p>
<div class="codehilite"><pre><span class="n">pre</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">DiscreteVar</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_9">Arguments</h3>
<ul>
<li><code>x::Discrete</code></li>
</ul>
<h3 id="returns_8">Returns</h3>
<ul>
<li>A value stored just prior to an event.</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1024">Sims/src/main.jl:1024</a></p>
<h2 id="reinit">reinit</h2>
<p><code>reinit</code> is used in Event responses to redefine variables. </p>
<div class="codehilite"><pre><span class="n">reinit</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">DiscreteVar</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_10">Arguments</h3>
<ul>
<li><code>x::UnknownVariable</code> : the object to be reinitialized.</li>
<li><code>y</code> : value for redefinition.</li>
</ul>
<h3 id="returns_9">Returns</h3>
<ul>
<li>A value stored just prior to an event.</li>
</ul>
<h3 id="examples_8">Examples</h3>
<p>Here is the definition of Step in the standard library:</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> Step</span><span class="p">(</span><span class="n">y</span><span class="p">::</span><span class="n">Signal</span><span class="p">,</span> 
              <span class="n">height</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
              <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> 
              <span class="n">startTime</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ymag</span> <span class="o">=</span> <span class="n">Discrete</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ymag</span>  
        <span class="n">Event</span><span class="p">(</span><span class="n">MTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">,</span>
              <span class="n">Equation</span><span class="p">[</span><span class="n">reinit</span><span class="p">(</span><span class="n">ymag</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)],</span>   <span class="c"># positive crossing</span>
              <span class="n">Equation</span><span class="p">[</span><span class="n">reinit</span><span class="p">(</span><span class="n">ymag</span><span class="p">,</span> <span class="n">offset</span><span class="p">)])</span>            <span class="c"># negative crossing</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p>See also <a href="../../../lib/index.html#IdealThyristor">IdealThyristor</a> in the standard library.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1118">Sims/src/main.jl:1118</a></p>
<h2 id="value">value</h2>
<p>The value of an object or UnknownVariable.</p>
<div class="codehilite"><pre><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_11">Arguments</h3>
<ul>
<li><code>x</code> : an object</li>
</ul>
<h3 id="returns_10">Returns</h3>
<p>For standard Julia objects, <code>value(x)</code> returns x. For Unknowns and
other ModelTypes, returns the current value of the object. <code>value</code>
evaluates immediately, so don't expect to use this in model
expressions, except to grab an immediate value.</p>
<h3 id="examples_9">Examples</h3>
<div class="codehilite"><pre><span class="n">v</span> <span class="o">=</span> <span class="n">Voltage</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">-</span> <span class="n">value</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L563">Sims/src/main.jl:563</a></p>
<h2 id="equation">Equation</h2>
<p>Equations are used in Models. Right now, Equation is defined as <code>Any</code>,
but that may change.  Normally, Equations are of type Unknown,
DerUnknown, MExpr, or Array{Equation} (for nesting models).</p>
<h3 id="examples_10">Examples</h3>
<p>Models return Arrays of Equations. Here is an example:</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> Vanderpol</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">Equation</span><span class="p">[</span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>      <span class="c"># == 0 is assumed</span>
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
    <span class="p">]</span>
<span class="k">end</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">Vanderpol</span><span class="p">()</span> <span class="p">)</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L489">Sims/src/main.jl:489</a></p>
<h2 id="mtime">MTime</h2>
<p>The model time - a special unknown variable.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L654">Sims/src/main.jl:654</a></p>
<h2 id="model">Model</h2>
<p>Represents a vector of Equations. For now, <code>Equation</code> equals <code>Any</code>, but
in the future, it may only include ModelType's.</p>
<p>Models return Arrays of Equations. </p>
<h3 id="examples_11">Examples</h3>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> Vanderpol</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">Equation</span><span class="p">[</span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>      <span class="c"># == 0 is assumed</span>
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
    <span class="p">]</span>
<span class="k">end</span>
<span class="n">dump</span><span class="p">(</span> <span class="n">Vanderpol</span><span class="p">()</span> <span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">Vanderpol</span><span class="p">(),</span> <span class="mf">50.0</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L513">Sims/src/main.jl:513</a></p>
<h2 id="equations">@equations</h2>
<p>A helper to make writing Models a little easier. It allows the use of
<code>=</code> in model equations.</p>
<div class="codehilite"><pre><span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
    <span class="o">...</span>
<span class="k">end</span>
</pre></div>


<h3 id="arguments_12">Arguments</h3>
<ul>
<li><code>eq</code> : the model equations, normally in a <code>begin</code> - <code>end</code> block.</li>
</ul>
<h3 id="returns_11">Returns</h3>
<ul>
<li><code>::Array{Equation}</code></li>
</ul>
<h3 id="examples_12">Examples</h3>
<p>The following are both equivalent:</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> Vanderpol1</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">Equation</span><span class="p">[</span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>      <span class="c"># == 0 is assumed</span>
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span>
    <span class="p">]</span>
<span class="k">end</span>
<span class="k">function</span><span class="nf"> Vanderpol2</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">)</span> 
    <span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1383">Sims/src/main.jl:1383</a></p>
<h2 id="defaultunknown">DefaultUnknown</h2>
<p>The default UnknownCategory.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L152">Sims/src/main.jl:152</a></p>
<h2 id="derunknown">DerUnknown</h2>
<p>An UnknownVariable representing the derivitive of an Unknown, normally
created with <code>der(x)</code>.</p>
<h3 id="arguments_13">Arguments</h3>
<ul>
<li><code>x::Unknown</code> : the Unknown variable</li>
<li><code>val</code> : initial value, defaults to 0.0</li>
</ul>
<h3 id="examples_13">Examples</h3>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">der</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">typeof</span><span class="p">(</span><span class="n">der</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L264">Sims/src/main.jl:264</a></p>
<h2 id="discrete">Discrete</h2>
<p>Discrete is a type for discrete variables. These are only changed
during events. They are not used by the integrator. Because they are
not used by the integrator, almost any type can be used as a discrete
variable.</p>
<div class="codehilite"><pre><span class="n">Discrete</span><span class="p">()</span>
<span class="n">Discrete</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">Discrete</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Discrete</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Discrete</span><span class="p">(</span><span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Discrete</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">Discrete</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_14">Arguments</h3>
<ul>
<li><code>s::Symbol</code> : identification symbol, defaults to <code>gensym()</code></li>
<li><code>value</code> : initial value and type information, defaults to 0.0</li>
<li><code>label::String</code> : labeling string, defaults to ""</li>
</ul>
<h3 id="details">Details</h3>
<p>Discrete variables are currently quite limited. You cannot have
systems of equations where the values of Discrete variables propagates
easily. A crude mechanism for some chaining is provided by
<code>addhook!</code>. It would be nice to have data flow support (reactive
programming). The package
<a href="https://github.com/JuliaLang/Reactive.jl">Reactive.jl</a> may help here.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L921">Sims/src/main.jl:921</a></p>
<h2 id="discretevar">DiscreteVar</h2>
<p>A helper type used inside of the residual function.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L954">Sims/src/main.jl:954</a></p>
<h2 id="event">Event</h2>
<p>Event is the main type used for hybrid modeling. It contains a
condition for root finding and model expressions to process after
positive and negative root crossings are detected.</p>
<p>See also <a href="#BoolEvent">BoolEvent</a>.</p>
<div class="codehilite"><pre><span class="n">Event</span><span class="p">(</span><span class="n">condition</span><span class="p">::</span><span class="n">ModelType</span><span class="p">,</span> <span class="n">pos_response</span><span class="p">,</span> <span class="n">neg_response</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_15">Arguments</h3>
<ul>
<li><code>condition::ModelType</code> : an expression used for the event detection.</li>
<li><code>pos_response</code> : an expression indicating what to do when the
  condition crosses zero positively. May be Model or MExpr.</li>
<li><code>neg_response::Model</code> : an expression indicating what to do when the
  condition crosses zero in the negative direction. Defaults to
  Equation[].</li>
</ul>
<h3 id="examples_14">Examples</h3>
<p>See <a href="../../../lib/index.html#IdealThyristor">IdealThyristor</a> in the standard library.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1052">Sims/src/main.jl:1052</a></p>
<h2 id="initialequation">InitialEquation</h2>
<p>A ModelType describing initial equations. Current support is limited
and may be broken. There are no tests. The idea is that the equations
provided will only be used during the initial solution.</p>
<div class="codehilite"><pre><span class="n">InitialEquation</span><span class="p">(</span><span class="n">egs</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_16">Arguments</h3>
<ul>
<li><code>eqs::Array{Equation}</code> : a vector of equations, each to be equated
  to zero during the initial equation solution.</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L795">Sims/src/main.jl:795</a></p>
<h2 id="leftvar">LeftVar</h2>
<p>A helper type needed to mark unknowns as left-side variables in
assignments during event responses.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1076">Sims/src/main.jl:1076</a></p>
<h2 id="mexpr_1">MExpr</h2>
<p>Represents expressions used in models.</p>
<div class="codehilite"><pre><span class="n">MExpr</span><span class="p">(</span><span class="n">ex</span><span class="p">::</span><span class="n">Expr</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_17">Arguments</h3>
<ul>
<li><code>ex::Expr</code> : an expression</li>
</ul>
<h3 id="examples_15">Examples</h3>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="nb">typeof</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L321">Sims/src/main.jl:321</a></p>
<h2 id="modeltype">ModelType</h2>
<p>The main overall abstract type in Sims.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L136">Sims/src/main.jl:136</a></p>
<h2 id="parametertunknowncategory">Parameter{T&lt;:UnknownCategory}</h2>
<p>Represents an Unknown that stays constant through a simulation. Useful
for passing in at the top level.</p>
<div class="codehilite"><pre><span class="n">Parameter</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">Parameter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="n">Parameter</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Parameter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_18">Arguments</h3>
<ul>
<li><code>s::Symbol</code> : identification symbol, defaults to <code>gensym()</code></li>
<li><code>value</code> : initial value and type information, defaults to 0.0</li>
<li><code>label::String</code> : labeling string, defaults to ""</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L375">Sims/src/main.jl:375</a></p>
<h2 id="passedunknown">PassedUnknown</h2>
<p>An UnknownVariable used as a helper for the <code>delay</code> function.  It is
an identity unknown, but it doesn't replace with a reference to the y
array.</p>
<p>PassedUnknown(ref::UnknownVariable)</p>
<h3 id="arguments_19">Arguments</h3>
<ul>
<li><code>ref::UnknownVariable</code> : an Unknown</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L821">Sims/src/main.jl:821</a></p>
<h2 id="refbranch">RefBranch</h2>
<p>A special ModelType to specify branch flows into nodes. When the model
is flattened, equations are created to zero out branch flows into
nodes. </p>
<p>See also <a href="#Branch">Branch</a>.</p>
<div class="codehilite"><pre><span class="n">RefBranch</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> 
</pre></div>


<h3 id="arguments_20">Arguments</h3>
<ul>
<li><code>n</code> : the reference node.</li>
<li><code>i</code> : the flow variable that goes with this node.</li>
</ul>
<h3 id="references_1">References</h3>
<p>This nodal description is based on work by <a href="http://web.ict.kth.se/~dbro/">David
Broman</a>. See the following:</p>
<ul>
<li>http://www.eecs.berkeley.edu/Pubs/TechRpts/2012/EECS-2012-173.pdf</li>
<li>http://www.bromans.com/software/mkl/mkl-source-1.0.0.zip</li>
<li>https://github.com/david-broman/modelyze</li>
</ul>
<p><a href="https://github.com/david-broman/modelyze">Modelyze</a> has both
<code>RefBranch</code> and <code>Branch</code>.</p>
<h3 id="examples_16">Examples</h3>
<p>Here is an example of RefBranch used in the definition of a
HeatCapacitor in the standard library. <code>hp</code> is the reference node (a
HeatPort aka Temperature), and <code>Q_flow</code> is the flow variable.</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> HeatCapacitor</span><span class="p">(</span><span class="n">hp</span><span class="p">::</span><span class="n">HeatPort</span><span class="p">,</span> <span class="n">C</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">Q_flow</span> <span class="o">=</span> <span class="n">HeatFlow</span><span class="p">(</span><span class="n">compatible_values</span><span class="p">(</span><span class="n">hp</span><span class="p">))</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">RefBranch</span><span class="p">(</span><span class="n">hp</span><span class="p">,</span> <span class="n">Q_flow</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">.*</span> <span class="n">der</span><span class="p">(</span><span class="n">hp</span><span class="p">)</span> <span class="o">=</span> <span class="n">Q_flow</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p>Here is the definition of SignalCurrent from the standard library a
model that injects current (a flow variable) between two nodes:</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> SignalCurrent</span><span class="p">(</span><span class="n">n1</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">n2</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">I</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span>  
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">RefBranch</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span> 
        <span class="n">RefBranch</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="o">-</span><span class="n">I</span><span class="p">)</span> 
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L713">Sims/src/main.jl:713</a></p>
<h2 id="refdiscrete">RefDiscrete</h2>
<p>A helper type for Discretes used in Arrays.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L945">Sims/src/main.jl:945</a></p>
<h2 id="refunknowntunknowncategory">RefUnknown{T&lt;:UnknownCategory}</h2>
<p>An UnknownVariable used to allow Arrays as Unknowns. Normally created
with <code>getindex</code>. Defined methods include:</p>
<ul>
<li>getindex</li>
<li>length</li>
<li>size</li>
<li>hcat</li>
<li>vcat</li>
</ul>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L528">Sims/src/main.jl:528</a></p>
<h2 id="structuralevent">StructuralEvent</h2>
<p>StructuralEvent defines a type for elements that change the structure
of the model. An event is created where the condition crosses zero.
When the event is triggered, the model is re-flattened after replacing
<code>default</code> with <code>new_relation</code> in the model.</p>
<div class="codehilite"><pre><span class="n">StructuralEvent</span><span class="p">(</span><span class="n">condition</span><span class="p">::</span><span class="n">MExpr</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">new_relation</span><span class="p">::</span><span class="n">Function</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_21">Arguments</h3>
<ul>
<li><code>condition::MExpr</code> : an expression that will trigger the event at a
  zero crossing</li>
<li><code>default</code> : the default Model used</li>
<li><code>new_relation</code> : a function that returns a model that will replace
  the default model when the condition triggers the event.</li>
</ul>
<h3 id="examples_17">Examples</h3>
<p>Here is an example from examples/breaking_pendulum.jl:</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> FreeFall</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">)</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">vx</span>
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">vy</span>
        <span class="n">der</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">der</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.81</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> Pendulum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">)</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">phi0</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> 
    <span class="n">phi</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="n">phi0</span><span class="p">)</span>
    <span class="n">phid</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
    <span class="p">@</span><span class="n">equations</span> <span class="k">begin</span>
        <span class="n">der</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">=</span> <span class="n">phid</span>
        <span class="n">der</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">vx</span>
        <span class="n">der</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">vy</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">len</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">len</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">der</span><span class="p">(</span><span class="n">phid</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.81</span> <span class="o">/</span> <span class="n">len</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span><span class="nf"> BreakingPendulum</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="nb">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">()</span>
    <span class="n">Equation</span><span class="p">[</span>
        <span class="n">StructuralEvent</span><span class="p">(</span><span class="n">MTime</span> <span class="o">-</span> <span class="mf">5.0</span><span class="p">,</span>     <span class="c"># when time hits 5 sec, switch to FreeFall</span>
            <span class="n">Pendulum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">),</span>
            <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">FreeFall</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">))</span>
    <span class="p">]</span>
<span class="k">end</span>

<span class="n">p_y</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">BreakingPendulum</span><span class="p">(),</span> <span class="mf">6.0</span><span class="p">)</span>  
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L1289">Sims/src/main.jl:1289</a></p>
<h2 id="unknowncategory">UnknownCategory</h2>
<p>Categories of Unknown types; used to subtype Unknowns.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L147">Sims/src/main.jl:147</a></p>
<h2 id="unknownvariable">UnknownVariable</h2>
<p>An abstract type for variables to be solved. Examples include Unknown,
DerUnknown, and Parameter.</p>
<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L142">Sims/src/main.jl:142</a></p>
<h2 id="unknowntunknowncategory">Unknown{T&lt;:UnknownCategory}</h2>
<p>An Unknown represents variables to be solved in Sims. An <code>Unknown</code> is
a symbolic type. When used in Julia expressions, Unknowns combine into
<code>MExpr</code>s which are symbolic representations of equations.</p>
<p>Expressions (of type MExpr) are built up based on Unknown's. Unknown
is a symbol with a uniquely generated symbol name. If you have</p>
<p>Unknowns can contain Float64, Complex, and Array{Float64}
values. Additionally, Unknowns can be extended to support other types.
All Unknown types currently map to positions in an Array{Float64}.</p>
<p>In addition to a value, Unknowns can carry additional metadata,
including an identification symbol and a label. In the future, unit
information may be added.</p>
<p>Unknowns can also have type parameters. For example, <code>Voltage</code> is
defined as <code>Unknown{UVoltage}</code> in the standard library. The <code>UVoltage</code>
type parameter is a marker to distinguish those Unknown from
others. Users can add their own Unknown types. Different Unknown types
makes it easier to dispatch on model arguments.</p>
<div class="codehilite"><pre><span class="n">Unknown</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">fixed</span><span class="p">::</span><span class="kt">Bool</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">()</span>
<span class="n">Unknown</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">(</span><span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fixed</span><span class="p">::</span><span class="kt">Bool</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">fixed</span><span class="p">::</span><span class="kt">Bool</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}()</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">x</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">label</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fixed</span><span class="p">::</span><span class="kt">Bool</span><span class="p">)</span>
<span class="n">Unknown</span><span class="p">{</span><span class="n">T</span><span class="p">}(</span><span class="n">s</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>


<h3 id="arguments_22">Arguments</h3>
<ul>
<li><code>s::Symbol</code> : identification symbol, defaults to <code>gensym()</code></li>
<li><code>x</code> : initial value and type information, defaults to 0.0</li>
<li><code>label::String</code> : labeling string, defaults to ""</li>
</ul>
<h3 id="examples_18">Examples</h3>
<div class="codehilite"><pre>  <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">Unknown</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s">&quot;len&quot;</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">b</span><span class="o">^</span><span class="mi">2</span>
</pre></div>


<p><a href="https://github.com/tshort/Sims.jl/tree/41fa42185a92c02017ceab02d9b448fb8286c66e/src/main.jl#L210">Sims/src/main.jl:210</a></p>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>