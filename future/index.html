<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Development options - Sims.jl</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/github.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Sims.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../basics">Basics</a>
                            </li>
                        
                            <li >
                                <a href="../plotting">Plotting results</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../api/main">Modeling</a>
                            </li>
                        
                            <li >
                                <a href="../api/sim">Simulations</a>
                            </li>
                        
                            <li >
                                <a href="../api/utils">Utilities</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Standard library <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../lib/types">Types</a>
                            </li>
                        
                            <li >
                                <a href="../lib/blocks">Continuous blocks</a>
                            </li>
                        
                            <li >
                                <a href="../lib/electrical">Electrical</a>
                            </li>
                        
                            <li >
                                <a href="../lib/heat_transfer">Heat transfer</a>
                            </li>
                        
                            <li >
                                <a href="../lib/powersystems">Power systems</a>
                            </li>
                        
                            <li >
                                <a href="../lib/rotational">Rotational mechanics</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../examples/basics">Basics</a>
                            </li>
                        
                            <li >
                                <a href="../examples/lib">Standard library</a>
                            </li>
                        
                            <li >
                                <a href="../examples/neural">Neural</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Design <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../design">Considerations</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">Development options</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../license">License</a>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../design">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../license">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/tshort/Sims.jl/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#development-options">Development options</a></li>
        
            <li><a href="#better-symbolic-preprocessing">Better symbolic preprocessing</a></li>
        
            <li><a href="#better-initialization">Better initialization</a></li>
        
            <li><a href="#mapping-to-a-gui">Mapping to a GUI</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="development-options">Development options</h1>
<p>This document contains various thoughts on future development options.
Also on the table is a complete rewrite.</p>
<h2 id="better-symbolic-preprocessing">Better symbolic preprocessing</h2>
<p>Most Modelica tools do a number of preprocessing steps to simplify the
system. This makes it easier to calculate initial values and speed up
solutions. Here are some links:</p>
<ul>
<li>http://www.jmodelica.org/5109</li>
<li>http://staff.polito.it/roberto.zanino/sub1/teach_files/modelica_minicourse/03%20-%20Symbolic%20Manipulation.pdf</li>
<li>https://modelica.org/events/modelica2011/Proceedings/pages/papers/10_3_ID_110_a_fv.pdf </li>
</ul>
<h2 id="better-initialization">Better initialization</h2>
<p>The current initialization support is weak. It relies on DASSL or
Sundials to calculate initial values, and that doesn't honor Unknowns
with fixed <code>initial</code> values. Placeholders are in the Unknowns for
this, but they are not honored. The idea is to use <code>solve</code> for
initialization. Right now, this works with Kinsol and can solve
non-differential systems. Better symbolic support should make this
easier.</p>
<h2 id="mapping-to-a-gui">Mapping to a GUI</h2>
<p>Though I have no plans for a GUI, it's interesting to think about. I'm
not sure this functional / nodal approach works very well for mapping
to a gui.</p>
<p>A gui can easily generate the functional representation of a model
pieced together in a gui. The reverse is the challenge. Can we have a
gui that reads the code and makes a graphical representation of that?</p>
<h3 id="help">Help</h3>
<p>This one's easy. Just use whatever format Julia settles on.</p>
<h3 id="graphical-representation">Graphical representation</h3>
<p>The icon definition of an object could be returned as part of the
object's constructor call, either as an equation that's parsed
specially or as a separate component. A link to an SVG file would be
the easiest. A nice feature is having the icon image change based on
parameters. That's tougher to accomplish. Icon changing could be nice
to adjust the number of ports (optional heat port for example) or to
indicate grounding configuration.</p>
<h3 id="model-input-parameters">Model input parameters</h3>
<p>This one's tougher. How can we pull in parameter information? I'm not
sure how to retrieve method argument lists in Julia. For mapping to a
gui, this is probably the most important function. We want a
documentation string, a label, units, and more. Instead of arguments
being simple values (like nodal voltages), each would need to be
packed with more information. For example, a node voltage may become:</p>
<div class="codehilite"><pre><span class="k">type</span><span class="nc"> ElectricalNode</span>
    <span class="n">v</span><span class="p">::</span><span class="n">Unknown</span>
    <span class="n">description</span><span class="p">::</span><span class="n">String</span>
    <span class="n">unit</span><span class="p">::</span><span class="n">String</span> <span class="c"># physical units</span>
    <span class="n">X</span><span class="p">::</span><span class="kt">Float64</span>   <span class="c"># graphical coordinate</span>
    <span class="n">Y</span><span class="p">::</span><span class="kt">Float64</span>   <span class="c"># graphical coordinate</span>
<span class="k">end</span>
</pre></div>


<p>The type above could be split into pieces, with standards for
annotation. In any case, we'd need standard extraction methods to pull
data out about parameters.</p>
<h3 id="connections">Connections</h3>
<p>This is the biggest deficiency of using a nodal approach. It's tough
to see how to map connections. As a user plops down models, where is a
given "Node" defined?</p>
<p>Maybe a node could have a graphical list of the connections to all
top-level models attached.</p>
<p>TODO: Look at how Simplorer (VHDL-AMS) works. </p>
<h3 id="one-option">One option</h3>
<p>One option to including GUI-related metadata is to use method
definitions. Here is an example of a resistor definition along with
methods defining metadata that use the same signature, except with a
leading "tag".</p>
<div class="codehilite"><pre><span class="k">function</span><span class="nf"> Resistor</span><span class="p">(</span><span class="n">n1</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">n2</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">R</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">Current</span><span class="p">(</span><span class="n">compatible_values</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">Voltage</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">-</span> <span class="n">value</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
    <span class="n">Equation</span><span class="p">[</span>
        <span class="n">Branch</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">.*</span> <span class="n">i</span> <span class="o">-</span> <span class="n">v</span>   <span class="c"># == 0 is implied</span>
    <span class="p">]</span>
<span class="k">end</span>

<span class="c"># Icon - returns a file in SVG format</span>
<span class="n">Resistor</span><span class="p">(::</span><span class="n">SIMS_ICON</span><span class="p">,</span> <span class="n">n1</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">n2</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">R</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span> <span class="o">=</span> <span class="n">readall</span><span class="p">(</span><span class="s">&quot;img/resistor1.svg&quot;</span><span class="p">)</span>

<span class="c"># Parameter metadata</span>
<span class="n">Resistor</span><span class="p">(::</span><span class="n">SIMS_PARAMETERS</span><span class="p">,</span> <span class="n">n1</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">n2</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">R</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;n1&quot;</span><span class="p">,</span> <span class="n">ElectricalNode</span><span class="p">,</span> <span class="s">&quot;Positive pin (potential `n1` &gt; `n2` for positive voltage drop `v`)&quot;</span><span class="p">}</span>
    <span class="p">{</span><span class="s">&quot;n2&quot;</span><span class="p">,</span> <span class="n">ElectricalNode</span><span class="p">,</span> <span class="s">&quot;Negative pin&quot;</span><span class="p">}</span>
    <span class="p">{</span><span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="s">&quot;Electrical resistance&quot;</span><span class="p">}</span>
<span class="p">}</span>

<span class="c"># Parameter metadata - alternate definition</span>
<span class="n">Resistor</span><span class="p">(::</span><span class="n">SIMS_PARAMETERS</span><span class="p">,</span> <span class="n">n1</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">n2</span><span class="p">::</span><span class="n">ElectricalNode</span><span class="p">,</span> <span class="n">R</span><span class="p">::</span><span class="n">Signal</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;Positive pin (potential `n1` &gt; `n2` for positive voltage drop `v`)&quot;</span>
    <span class="s">&quot;Negative pin&quot;</span>
    <span class="s">&quot;Electrical resistance&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Some ways to improve on what's above are:</p>
<ul>
<li>Automate parameter metadata. Extract these right from method
  signatures.</li>
<li>In the help file, automatically insert the method signature and
  parameter information.</li>
<li>Parameter metadata could also include GUI information like
  checkboxes or menu selectors.</li>
<li>Types could also be mapped to GUI menu's for fill-in of information.
  This could also apply to <code>options</code> (options.jl style with defaults).
  Tab/grouping information in dialogs could also be handled with
  method definitions like:</li>
</ul>
<div class="codehilite"><pre><span class="k">type</span><span class="nc"> MyType</span>
    <span class="n">male</span><span class="p">::</span><span class="kt">Bool</span>      <span class="c"># converted to checkbox</span>
    <span class="n">radius</span><span class="p">::</span><span class="kt">Float64</span>
    <span class="n">name</span><span class="p">::</span><span class="n">String</span>
    <span class="n">state</span><span class="p">::</span><span class="n">Choices</span><span class="p">([</span><span class="s">&quot;AL&quot;</span><span class="p">,</span> <span class="s">&quot;AK&quot;</span><span class="p">,</span> <span class="s">&quot;AZ&quot;</span><span class="p">])</span>  <span class="c"># not sure if this will work</span>
<span class="k">end</span>

<span class="n">MyType</span><span class="p">(::</span><span class="n">SIMS_PARAMETERS</span><span class="p">,</span> <span class="n">male</span><span class="p">::</span><span class="kt">Bool</span><span class="p">,</span> <span class="n">radius</span><span class="p">::</span><span class="kt">Float64</span><span class="p">,</span> <span class="n">name</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">state</span><span class="p">::</span><span class="n">Choices</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;Male&quot;</span><span class="p">,</span> <span class="s">&quot;Tab1&quot;</span><span class="p">}</span>
    <span class="p">{</span><span class="s">&quot;Conductor radius, m&quot;</span><span class="p">,</span> <span class="s">&quot;Tab1&quot;</span><span class="p">}</span>
    <span class="p">{</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="s">&quot;Tab2&quot;</span><span class="p">}</span>
    <span class="p">{</span><span class="s">&quot;State&quot;</span><span class="p">,</span> <span class="s">&quot;Tab2&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Also, this approach does allow changing the icon based on parameters.
I'm not sure it helps with the problem of mapping connections.</p>
<h3 id="web-interfaces">Web interfaces</h3>
<p>An easier application to think about is an autogenerated web interface
to a model. For that, we need the model input parameters and maybe a
diagram. We don't need a full two-way GUI. The diagram can be static.</p>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>